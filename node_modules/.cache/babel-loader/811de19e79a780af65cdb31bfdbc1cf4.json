{"ast":null,"code":"import _objectSpread from\"/Users/bluevisionai/Desktop/untitled folder/untitled folder/gitdagray/binpack-16-03-23/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/bluevisionai/Desktop/untitled folder/untitled folder/gitdagray/binpack-16-03-23/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/bluevisionai/Desktop/untitled folder/untitled folder/gitdagray/binpack-16-03-23/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/bluevisionai/Desktop/untitled folder/untitled folder/gitdagray/binpack-16-03-23/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _defineProperty from\"/Users/bluevisionai/Desktop/untitled folder/untitled folder/gitdagray/binpack-16-03-23/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import{Button,// TextField,\nCircularProgress,Icon,Autocomplete,Box,styled,Card,Divider}from'@mui/material';import{Span,small}from'app/components/Typography';import{useEffect,useState,Fragment}from'react';import{TextValidator,ValidatorForm}from'react-material-ui-form-validator';import axios from'app/api/axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AutoComplete=styled(Autocomplete)(function(){return{};});function sleep(){var delay=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return new Promise(function(resolve){return setTimeout(resolve,delay);});}var TextField=styled(TextValidator)(function(){return{width:'100%',marginBottom:'16px'};});var CardRoot=styled(Card)(function(_ref){var theme=_ref.theme;return _defineProperty({marginBottom:'24px',padding:'24px !important'},theme.breakpoints.down('sm'),{paddingLeft:'16px !important'});});var CardHeader=styled(Box)(function(){return{display:'flex',paddingLeft:'24px',paddingRight:'24px',marginBottom:'12px',alignItems:'center',justifyContent:'space-between'};});var Title=styled('span')(function(){return{fontSize:'1rem',fontWeight:'500',textTransform:'capitalize'};});var accessToken=window.localStorage.getItem('accessToken');var DriverAssignCard=function DriverAssignCard(_ref3){var requisition=_ref3.requisition;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),open=_useState2[0],setOpen=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),options=_useState4[0],setOptions=_useState4[1];var loading=open&&options.length===0;var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),hospitalOptions=_useState6[0],setHospitalOptions=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),manifest=_useState8[0],setManifests=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),hospitalDropdownValue=_useState10[0],setHospitalDropdownValue=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),manifeststatus=_useState12[0],setManifeststatus=_useState12[1];var fetchManifestlData=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var manifest_url,get_response,_get_response$data,status,manifests;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;manifest_url='/manifest/requisionId?requisition_id='+requisition.requision_id;_context.next=4;return axios.get(manifest_url,{headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(accessToken)}});case 4:get_response=_context.sent;_get_response$data=get_response.data,status=_get_response$data.status,manifests=_get_response$data.manifests;if(status==='success'){setManifests(manifests[0]);}console.log('setManifests: '+manifest._id);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);console.log('error: '+_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function fetchManifestlData(){return _ref4.apply(this,arguments);};}();useEffect(function(){var active=true;var userlist=[];if(!loading){return undefined;}_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var url,response,_response$data,status,users;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;console.log('requisition.serviceProviderId: '+requisition.serviceProviderId);url='/users/userfield?company_id='+requisition.serviceProviderId;_context2.next=5;return axios.get(url);case 5:response=_context2.sent;_response$data=response.data,status=_response$data.status,users=_response$data.users;if(status==='success'){users.forEach(function(user){console.log('user.role: '+user.role);if(user.role==='driver'){console.log('user: '+user.name);userlist.push({id:user._id,name:user.name+' '+user.surname});}});}setHospitalOptions(userlist);console.log('hospitalOptions: '+hospitalOptions);_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](0);console.log('error: '+_context2.t0);case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[0,12]]);}))();return function(){active=false;};},[loading,hospitalOptions]);useEffect(function(){fetchManifestlData();if(!open){setHospitalOptions([]);}},[open]);var handleHospitalDropdownChange=function handleHospitalDropdownChange(_,newValue){console.log('newValue');console.log(newValue);setHospitalDropdownValue(newValue);};var handleManifeststatus=function handleManifeststatus(_,newValue){console.log('ManifeststatusnewValue: '+newValue.label);if(newValue&&newValue.inputValue){setManifeststatus({label:newValue.inputValue});return;}setManifeststatus(newValue);};var handleSubmit=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var response,status,requisition_url,_response,_status;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;console.log('manifest: '+manifest._id);console.log('hospitalDropdownValue.id: '+hospitalDropdownValue.id);_context3.next=5;return axios.patch('/manifest/'+manifest._id,{driver_id:hospitalDropdownValue.id,status:manifeststatus.label,updated_at:new Date(),headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(accessToken)}});case 5:response=_context3.sent;status=response.data.status;if(status==='success'){// setOpen(true);\n//   navigate('/netcare/admin/user');\n}_context3.next=13;break;case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](0);console.log('patch_error1: '+_context3.t0);case 13:_context3.prev=13;requisition_url='/requisition/'+requisition._id;_context3.next=17;return axios.patch(requisition_url,{driver_id:hospitalDropdownValue.id,status:manifeststatus.label,updated_at:new Date(),headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(accessToken)}});case 17:_response=_context3.sent;_status=_response.data.status;if(_status==='success'){// setOpen(true);\n//   navigate('/netcare/admin/user');\n}_context3.next=25;break;case 22:_context3.prev=22;_context3.t1=_context3[\"catch\"](13);console.log('patch_error2: '+_context3.t1);case 25:case\"end\":return _context3.stop();}}},_callee3,null,[[0,10],[13,22]]);}));return function handleSubmit(){return _ref6.apply(this,arguments);};}();var DriverCheck=function DriverCheck(requisition){console.log('manifest.driver_id: '+requisition.driver_id);if(requisition.driver_id!==null||requisition.driver_id!==''){return/*#__PURE__*/_jsx(\"small\",{children:\"A driver has already been assigned to this task.\"});}};return/*#__PURE__*/_jsx(CardRoot,{children:/*#__PURE__*/_jsxs(ValidatorForm,{onSubmit:handleSubmit,onError:function onError(){return null;},children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsx(Title,{children:\"Assign Driver\"}),DriverCheck(requisition)]}),/*#__PURE__*/_jsx(Divider,{sx:{my:3}}),/*#__PURE__*/_jsx(Box,{ml:\"-5px\",children:/*#__PURE__*/_jsx(AutoComplete,{value:manifeststatus,options:manifest_status,onChange:handleManifeststatus,getOptionLabel:function getOptionLabel(option){return option.label;},renderInput:function renderInput(params){return/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({},params),{},{label:\"Manifest Status\",variant:\"outlined\"}));}})}),/*#__PURE__*/_jsx(Box,{ml:\"-5px\",children:/*#__PURE__*/_jsx(AutoComplete,{open:open,options:hospitalOptions,loading:loading,onChange:handleHospitalDropdownChange,id:\"driver\",onOpen:function onOpen(){return setOpen(true);},onClose:function onClose(){return setOpen(false);},getOptionLabel:function getOptionLabel(option){return option.name;},isOptionEqualToValue:function isOptionEqualToValue(option,value){return option.name===value.name;},renderInput:function renderInput(params){return/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({},params),{},{fullWidth:true,variant:\"outlined\",label:\"Driver\",InputProps:_objectSpread(_objectSpread({},params.InputProps),{},{endAdornment:/*#__PURE__*/_jsxs(Fragment,{children:[loading?/*#__PURE__*/_jsx(CircularProgress,{color:\"inherit\",size:20}):null,params.InputProps.endAdornment]})})}));}})}),/*#__PURE__*/_jsxs(Button,{color:\"primary\",variant:\"contained\",type:\"submit\",children:[/*#__PURE__*/_jsx(Icon,{children:\"send\"}),/*#__PURE__*/_jsx(Span,{sx:{pl:1,textTransform:'capitalize'},children:\"Submit\"})]})]})});};var manifest_status=[{label:'Awaiting Acceptance'},{label:'Assigned to Driver'},{label:'Waste Collected'},{label:'En Route to Sorting'},{label:'En Route to Landfill'},{label:'En Route to Scrapyard/Recycling Deport'},{label:'Sorting Facility'},{label:'Handed Over'},{label:'Waste Disposed'}];export default DriverAssignCard;","map":null,"metadata":{},"sourceType":"module"}